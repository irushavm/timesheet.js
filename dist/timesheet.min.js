!function(){"use strict";var Timesheet=function(opts){this.theme=opts&&opts.theme||"default",this.showDates=opts&&opts.showDates,this.labelsBelow=opts&&opts.labelsBelow,opts&&opts.events&&(this.events=this.parseEvents(opts.events||[]),this.bounds=this.events.reduce(function(accBounds,event){return accBounds.max<event.end&&(accBounds.max=event.end.getFullYear()+(opts.padYears||1)),(!accBounds.min||accBounds.min>event.begin)&&(accBounds.min=event.begin.getFullYear()-(opts.padYears||1)),accBounds},{max:0})),"undefined"!=typeof document&&(this.container=document.querySelector("#"+opts.targetId))};Timesheet.prototype.render=function(){this.container.className="timesheet color-scheme-"+this.theme,this.createBins(),this.insertEvents()},Timesheet.prototype.insertEvents=function(){var widthMonth=this.container.querySelector(".scale section").offsetWidth,_this=this,html=this.events.map(function(event){var bubble=_this.createBubble(widthMonth,_this.bounds.min,event.begin,event.end);return"<li "+(_this.labelsBelow?"style=margin-bottom:"+(_this.showDates?30:20)+'px;"':"")+'><span style="margin-left: '+bubble.getStartOffset()+"px; width: "+bubble.getWidth()+'px;" class="bubble bubble-'+(event.className||"default")+'" data-duration="'+(event.end?Math.round((event.end-event.begin)/1e3/60/60/24/39):"")+'"></span>'+(_this.showDates?'<span class="date" '+(_this.labelsBelow?' style="position: absolute; top: 15px; left:'+bubble.getStartOffset()+'px;"':"")+">"+bubble.getDateLabel()+"</span> ":"")+'<span class="label" '+(_this.labelsBelow?'style="position:absolute; top: '+(_this.showDates?30:15)+"px; left:"+bubble.getStartOffset()+'px;"':"")+">"+event.label+"</span></li>"});this.container.innerHTML+='<ul class="data">'+html.join("")+"</ul>"},Timesheet.prototype.createBins=function(){for(var bins=[],c=this.bounds.min;c<=this.bounds.max;c++)bins.push("<section>"+c+"</section>");this.container.innerHTML='<div class="scale">'+bins.join("")+"</div>",console.log("containerB",this.container.querySelector(".scale").offsetWidth),this.container.style.width=this.container.querySelector(".scale").offsetWidth+"px",console.log("c",this.container.style.width)},Timesheet.prototype.parseDate=function(date){return-1===date.indexOf("/")?(date=new Date(parseInt(date,10),0,1),date.hasMonth=!1):(date=date.split("/"),date=new Date(parseInt(date[1],10),parseInt(date[0],10)-1,1),date.hasMonth=!0),date},Timesheet.prototype.parseEvents=function(events){var _this=this;return events.map(function(event){return{begin:event.begin&&_this.parseDate(event.begin),end:event.end&&_this.parseDate(event.end),label:event.label,className:event.className}})},Timesheet.prototype.createBubble=function(wMonth,min,start,end){return new Bubble(wMonth,min,start,end)};var Bubble=function(wMonth,min,start,end){this.min=min,this.start=start,this.end=end,this.widthMonth=wMonth};Bubble.prototype.formatMonth=function(num){return num=parseInt(num,10),num>=10?num:"0"+num},Bubble.prototype.getStartOffset=function(){return this.widthMonth/12*(12*(this.start.getFullYear()-this.min)+this.start.getMonth())},Bubble.prototype.getFullYears=function(){return(this.end&&this.end.getFullYear()||this.start.getFullYear())-this.start.getFullYear()},Bubble.prototype.getMonths=function(){var fullYears=this.getFullYears(),months=0;return this.end?this.end.hasMonth?(months+=this.end.getMonth()+1,months+=12-(this.start.hasMonth?this.start.getMonth():0),months+=12*(fullYears-1)):(months+=12-(this.start.hasMonth?this.start.getMonth():0),months+=12*(fullYears-1>0?fullYears-1:0)):months+=this.start.hasMonth?1:12,months},Bubble.prototype.getWidth=function(){return this.widthMonth/12*this.getMonths()},Bubble.prototype.getDateLabel=function(){return[(this.start.hasMonth?this.formatMonth(this.start.getMonth()+1)+"/":"")+this.start.getFullYear(),this.end?"-"+(this.end.hasMonth?this.formatMonth(this.end.getMonth()+1)+"/":"")+this.end.getFullYear():""].join("")},window.Timesheet=Timesheet}();